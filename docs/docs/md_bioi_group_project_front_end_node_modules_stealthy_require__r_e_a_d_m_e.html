<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vaccine Dashboard: Stealthy-Require</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vaccine Dashboard
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_bioi_group_project_front_end_node_modules_stealthy_require__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Stealthy-Require </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/analog-nico/stealthy-require"><img src="https://img.shields.io/travis/analog-nico/stealthy-require/master.svg?style=flat-square" alt="Build Status" style="pointer-events: none;" class="inline"/></a> <a href="https://coveralls.io/r/analog-nico/stealthy-require"><img src="https://img.shields.io/coveralls/analog-nico/stealthy-require.svg?style=flat-square" alt="Coverage Status" style="pointer-events: none;" class="inline"/></a> <a href="https://david-dm.org/analog-nico/stealthy-require"><img src="https://img.shields.io/david/analog-nico/stealthy-require.svg?style=flat-square" alt="Dependency Status" style="pointer-events: none;" class="inline"/></a></p>
<p>This is probably the closest you can currently get to require something in node.js with completely bypassing the require cache.</p>
<p><code>stealthy-require</code> works like this:</p>
<ol type="1">
<li>It clears the require cache.</li>
<li>It calls a callback in which you require your module(s) without the cache kicking in.</li>
<li>It clears the cache again and restores its old state.</li>
</ol>
<p>The restrictions are:</p>
<ul>
<li><a href="https://github.com/nodejs/node/issues/5016">Native modules cannot be required twice.</a> Thus this module bypasses the require cache only for non-native (e.g. JS) modules.</li>
<li>The require cache is only bypassed for all operations that happen synchronously when a module is required. If a module lazy loads another module at a later time that require call will not bypass the cache anymore.</li>
</ul>
<p>This means you should have a close look at all internal require calls before you decide to use this library.</p>
<h1><a class="anchor" id="autotoc_md28196"></a>
Installation</h1>
<p><a href="https://npmjs.org/package/stealthy-require"><img src="https://nodei.co/npm/stealthy-require.png?downloads=true" alt="NPM Stats" class="inline"/></a></p>
<p>This is a module for node.js and is installed via npm:</p>
<div class="fragment"><div class="line">npm install stealthy-require --save</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28197"></a>
Usage</h1>
<p>Let's say you want to bypass the require cache for this require call:</p>
<div class="fragment"><div class="line">var request = require(&#39;request&#39;);</div>
</div><!-- fragment --><p>With <code>stealthy-require</code> you can do that like this:</p>
<div class="fragment"><div class="line">var stealthyRequire = require(&#39;stealthy-require&#39;);</div>
<div class="line"> </div>
<div class="line">var requestFresh = stealthyRequire(require.cache, function () {</div>
<div class="line">    return require(&#39;request&#39;);</div>
<div class="line">});</div>
</div><!-- fragment --><p>The require cache is bypassed for the module you require (i.e. <code>request</code>) as well as all modules the module requires (i.e. <code>http</code> and many more).</p>
<p>Sometimes the require cache shall not be bypassed for specific modules. E.g. <code>request</code> is required but <code>tough-cookie</code> – on which <code>request</code> depends on – shall be required using the regular cache. For that you can pass two extra arguments to <code>stealthyRequire(...)</code>:</p>
<ul>
<li>A callback that requires the modules that shall be required without bypassing the cache</li>
<li>The <code>module</code> variable</li>
</ul>
<div class="fragment"><div class="line">var stealthyRequire = require(&#39;stealthy-require&#39;);</div>
<div class="line"> </div>
<div class="line">var requestFresh = stealthyRequire(require.cache, function () {</div>
<div class="line">    return require(&#39;request&#39;);</div>
<div class="line">},</div>
<div class="line">function () {</div>
<div class="line">    require(&#39;tough-cookie&#39;); // No return needed</div>
<div class="line">    // You can require multiple modules here</div>
<div class="line">}, module);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28198"></a>
Usage with Module Bundlers</h1>
<ul>
<li><a href="https://webpack.github.io">Webpack</a> works out-of-the-box like described in the <a href="#usage">Usage section</a> above.</li>
<li><a href="http://browserify.org">Browserify</a> does not expose <code>require.cache</code>. However, as of <code>browserify@13.0.1</code> the cache is passed as the 6th argument to CommonJS modules. Thus you can pass this argument instead:</li>
</ul>
<div class="fragment"><div class="line">// Tweak for Browserify - using arguments[5] instead of require.cache</div>
<div class="line">var requestFresh = stealthyRequire(arguments[5], function () {</div>
<div class="line">    return require(&#39;request&#39;);</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28199"></a>
Preventing a Memory Leak When Repeatedly Requiring Fresh Module Instances in Node.js</h1>
<p>If you are using <code>stealthy-require</code> in node.js and repeatedly require fresh module instances the <code>module.children</code> array will hold all module instances which prevents unneeded instances to be garbage collected.</p>
<p>Assume your code calls <code>doSomething()</code> repeatedly.</p>
<div class="fragment"><div class="line">var stealthyRequire = require(&#39;stealthy-require&#39;);</div>
<div class="line"> </div>
<div class="line">function doSomething() {</div>
<div class="line"> </div>
<div class="line">    var freshInstance = stealthyRequire(require.cache, function () {</div>
<div class="line">        return require(&#39;some-module&#39;);</div>
<div class="line">    });</div>
<div class="line">    </div>
<div class="line">    return freshInstance.calc();</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p>After <code>doSomething()</code> returns <code>freshInstance</code> is not used anymore but won’t be garbage collected because <code>module.children</code> still holds a reference. The solution is to truncate <code>module.children</code> accordingly:</p>
<div class="fragment"><div class="line">var stealthyRequire = require(&#39;stealthy-require&#39;);</div>
<div class="line"> </div>
<div class="line">function doSomething() {</div>
<div class="line"> </div>
<div class="line">    var initialChildren = module.children.slice(); // Creates a shallow copy of the array</div>
<div class="line"> </div>
<div class="line">    var freshInstance = stealthyRequire(require.cache, function () {</div>
<div class="line">        return require(&#39;some-module&#39;);</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    module.children = initialChildren;</div>
<div class="line"> </div>
<div class="line">    return freshInstance.calc();</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>slice</code> operation removes all new <code>module.children</code> entries created during the <code>stealthyRequire(...)</code> call and thus <code>freshInstance</code> gets garbage collected after <code>doSomething()</code> returns.</p>
<h1><a class="anchor" id="autotoc_md28200"></a>
Technical Walkthrough</h1>
<div class="fragment"><div class="line">// 1. Load stealthy-require</div>
<div class="line">var stealthyRequire = require(&#39;stealthy-require&#39;);</div>
<div class="line">// This does nothing but loading the code.</div>
<div class="line">// It has no side-effects like patching the module loader or anything.</div>
<div class="line"> </div>
<div class="line">// Any regular require works as always.</div>
<div class="line">var request1 = require(&#39;request&#39;);</div>
<div class="line"> </div>
<div class="line">// 2. Call stealthyRequire with passing the require cache and a callback.</div>
<div class="line">var requestFresh = stealthyRequire(require.cache, function () {</div>
<div class="line"> </div>
<div class="line">    // 2a. Before this callback gets called the require cache is cleared.</div>
<div class="line"> </div>
<div class="line">    // 2b. Any require taking place here takes place on a clean require cache.</div>
<div class="line">    // Since the require call is part of the user&#39;s code it also works with module bundlers.</div>
<div class="line">    return require(&#39;request&#39;);</div>
<div class="line">    // Anything returned here will be returned by stealthyRequire(...).</div>
<div class="line"> </div>
<div class="line">    // 2c. After this callback gets called the require cache is</div>
<div class="line">    // - cleared again and</div>
<div class="line">    // - restored to its old state before step 2.</div>
<div class="line"> </div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// Any regular require again works as always.</div>
<div class="line">// In this case require returns the cached request module instance.</div>
<div class="line">var request2 = require(&#39;request&#39;);</div>
<div class="line"> </div>
<div class="line">// And voilà:</div>
<div class="line">request1 === request2 // -&gt; true</div>
<div class="line">request1 === requestFresh // -&gt; false</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28201"></a>
Contributing</h1>
<p>To set up your development environment for <code>stealthy-require</code>:</p>
<ol type="1">
<li>Clone this repo to your desktop,</li>
<li>in the shell <code>cd</code> to the main folder,</li>
<li>hit <code>npm install</code>,</li>
<li>hit <code>npm install gulp -g</code> if you haven't installed gulp globally yet, and</li>
<li>run <code>gulp dev</code>. (Or run <code>node ./node_modules/.bin/gulp dev</code> if you don't want to install gulp globally.)</li>
</ol>
<p><code>gulp dev</code> watches all source files and if you save some changes it will lint the code and execute all tests. The test coverage report can be viewed from <code>./coverage/lcov-report/index.html</code>.</p>
<p>If you want to debug a test you should use <code>gulp test-without-coverage</code> to run all tests without obscuring the code by the test coverage instrumentation.</p>
<h1><a class="anchor" id="autotoc_md28202"></a>
Change History</h1>
<ul>
<li>v1.1.1 (2017-05-08)<ul>
<li>Fix that stops <code>undefined</code> entries from appearing in <code>require.cache</code> *(Thanks to @jasperjn from reporting this in <a href="https://github.com/analog-nico/stealthy-require/issues/4">issue #4</a>)*</li>
</ul>
</li>
<li>v1.1.0 (2017-04-25)<ul>
<li>Added ability to disable bypassing the cache for certain modules *(Thanks to @novemberborn for suggesting this in <a href="https://github.com/analog-nico/stealthy-require/issues/3">issue #3</a>)*</li>
<li>Added section in README about a <a href="#preventing-a-memory-leak-when-repeatedly-requiring-fresh-module-instances-in-nodejs">potential memory leak</a> *(Thanks to @Flarna and @novemberborn for bringing that up in <a href="https://github.com/analog-nico/stealthy-require/issues/2">issue #2</a>)*</li>
<li>Performance optimizations *(Thanks to @jcready for <a href="https://github.com/analog-nico/stealthy-require/pull/1">pull request #1</a>)*</li>
</ul>
</li>
<li>v1.0.0 (2016-07-18)<ul>
<li><b>Breaking Change:</b> API completely changed. Please read the <a href="#usage">Usage section</a> again.</li>
<li>Redesigned library to support module bundlers like <a href="https://webpack.github.io">Webpack</a> and <a href="http://browserify.org">Browserify</a></li>
</ul>
</li>
<li>v0.1.0 (2016-05-26)<ul>
<li>Initial version</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md28203"></a>
License (ISC)</h1>
<p>In case you never heard about the <a href="http://en.wikipedia.org/wiki/ISC_license">ISC license</a> it is functionally equivalent to the MIT license.</p>
<p>See the [LICENSE file](LICENSE) for details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
